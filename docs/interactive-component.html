<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 6 Interactive component | Data Career Opportunities Analysis</title>
  <meta name="description" content="Chapter 6 Interactive component | Data Career Opportunities Analysis" />
  <meta name="generator" content="bookdown 0.16 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 6 Interactive component | Data Career Opportunities Analysis" />
  <meta property="og:type" content="book" />
  
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 6 Interactive component | Data Career Opportunities Analysis" />
  
  
  

<meta name="author" content="Mutian Wang, Xinyuan He, Weitao Chen, Jianing Li" />


<meta name="date" content="2019-12-12" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="results.html"/>
<link rel="next" href="conclusion.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/htmlwidgets-1.5.1/htmlwidgets.js"></script>
<script src="libs/plotly-binding-4.9.1/plotly.js"></script>
<script src="libs/typedarray-0.1/typedarray.min.js"></script>
<link href="libs/crosstalk-1.0.0/css/crosstalk.css" rel="stylesheet" />
<script src="libs/crosstalk-1.0.0/js/crosstalk.min.js"></script>
<link href="libs/plotly-htmlwidgets-css-1.49.4/plotly-htmlwidgets.css" rel="stylesheet" />
<script src="libs/plotly-main-1.49.4/plotly-latest.min.js"></script>
<link href="libs/parallel-coordinates-2.1.8/parcoords.css" rel="stylesheet" />
<script src="libs/parcoords-binding-1.0.0/parcoords.js"></script>
<script src="libs/d3-5.10.0/d3.min.js"></script>



<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Data Jobs Analysis</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Introduction</a><ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#background"><i class="fa fa-check"></i><b>1.1</b> Background</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#motivation"><i class="fa fa-check"></i><b>1.2</b> Motivation</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="data-sources.html"><a href="data-sources.html"><i class="fa fa-check"></i><b>2</b> Data sources</a><ul>
<li class="chapter" data-level="2.1" data-path="data-sources.html"><a href="data-sources.html#glassdoor"><i class="fa fa-check"></i><b>2.1</b> Glassdoor</a></li>
<li class="chapter" data-level="2.2" data-path="data-sources.html"><a href="data-sources.html#indeed"><i class="fa fa-check"></i><b>2.2</b> Indeed</a></li>
<li class="chapter" data-level="2.3" data-path="data-sources.html"><a href="data-sources.html#city-data"><i class="fa fa-check"></i><b>2.3</b> City data</a><ul>
<li class="chapter" data-level="2.3.1" data-path="data-sources.html"><a href="data-sources.html#median-income"><i class="fa fa-check"></i><b>2.3.1</b> <span>2018 median income</span></a></li>
<li class="chapter" data-level="2.3.2" data-path="data-sources.html"><a href="data-sources.html#population"><i class="fa fa-check"></i><b>2.3.2</b> <span>Population</span></a></li>
<li class="chapter" data-level="2.3.3" data-path="data-sources.html"><a href="data-sources.html#violent-crime"><i class="fa fa-check"></i><b>2.3.3</b> <span>Violent crime</span></a></li>
<li class="chapter" data-level="2.3.4" data-path="data-sources.html"><a href="data-sources.html#cpi"><i class="fa fa-check"></i><b>2.3.4</b> <span>CPI</span></a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="data-transformation.html"><a href="data-transformation.html"><i class="fa fa-check"></i><b>3</b> Data transformation</a><ul>
<li class="chapter" data-level="3.1" data-path="data-transformation.html"><a href="data-transformation.html#glassdoor-1"><i class="fa fa-check"></i><b>3.1</b> Glassdoor</a></li>
<li class="chapter" data-level="3.2" data-path="data-transformation.html"><a href="data-transformation.html#indeed-1"><i class="fa fa-check"></i><b>3.2</b> Indeed</a></li>
<li class="chapter" data-level="3.3" data-path="data-transformation.html"><a href="data-transformation.html#city-data-1"><i class="fa fa-check"></i><b>3.3</b> City data</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="missing-values.html"><a href="missing-values.html"><i class="fa fa-check"></i><b>4</b> Missing values</a><ul>
<li class="chapter" data-level="4.1" data-path="missing-values.html"><a href="missing-values.html#glassdoor-2"><i class="fa fa-check"></i><b>4.1</b> Glassdoor</a></li>
<li class="chapter" data-level="4.2" data-path="missing-values.html"><a href="missing-values.html#indeed-2"><i class="fa fa-check"></i><b>4.2</b> Indeed</a></li>
<li class="chapter" data-level="4.3" data-path="missing-values.html"><a href="missing-values.html#city-data-2"><i class="fa fa-check"></i><b>4.3</b> City data</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="results.html"><a href="results.html"><i class="fa fa-check"></i><b>5</b> Results</a><ul>
<li class="chapter" data-level="5.1" data-path="results.html"><a href="results.html#us-labor-market-data-related-jobs-vs.others"><i class="fa fa-check"></i><b>5.1</b> US labor market: Data related jobs vs. others</a></li>
<li class="chapter" data-level="5.2" data-path="results.html"><a href="results.html#trends-of-data-related-jobs"><i class="fa fa-check"></i><b>5.2</b> Trends of data related jobs</a></li>
<li class="chapter" data-level="5.3" data-path="results.html"><a href="results.html#geographical-patterns-of-data-related-jobs"><i class="fa fa-check"></i><b>5.3</b> Geographical patterns of data related jobs</a></li>
<li class="chapter" data-level="5.4" data-path="results.html"><a href="results.html#best-cities-for-data-related-jobs"><i class="fa fa-check"></i><b>5.4</b> Best cities for data related jobs</a><ul>
<li class="chapter" data-level="5.4.1" data-path="results.html"><a href="results.html#data-scientist-job-statistics-in-10-different-cities"><i class="fa fa-check"></i><b>5.4.1</b> Data Scientist job statistics in 10 different cities</a></li>
<li class="chapter" data-level="5.4.2" data-path="results.html"><a href="results.html#correlation-between-city-features"><i class="fa fa-check"></i><b>5.4.2</b> Correlation between city features</a></li>
</ul></li>
<li class="chapter" data-level="5.5" data-path="results.html"><a href="results.html#what-are-the-most-relevant-to-data-related-jobs"><i class="fa fa-check"></i><b>5.5</b> What are the most relevant to data related jobs?</a><ul>
<li class="chapter" data-level="5.5.1" data-path="results.html"><a href="results.html#data-scientist-vs-data-analyst"><i class="fa fa-check"></i><b>5.5.1</b> Data Scientist vs Data Analyst</a></li>
<li class="chapter" data-level="5.5.2" data-path="results.html"><a href="results.html#business-analyst-vs-financial-analyst"><i class="fa fa-check"></i><b>5.5.2</b> Business Analyst vs Financial Analyst</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="interactive-component.html"><a href="interactive-component.html"><i class="fa fa-check"></i><b>6</b> Interactive component</a></li>
<li class="chapter" data-level="7" data-path="conclusion.html"><a href="conclusion.html"><i class="fa fa-check"></i><b>7</b> Conclusion</a><ul>
<li class="chapter" data-level="7.1" data-path="conclusion.html"><a href="conclusion.html#overview"><i class="fa fa-check"></i><b>7.1</b> Overview</a></li>
<li class="chapter" data-level="7.2" data-path="conclusion.html"><a href="conclusion.html#limitations-and-future-work"><i class="fa fa-check"></i><b>7.2</b> Limitations and future work</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Data Career Opportunities Analysis</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="interactive-component" class="section level1">
<h1><span class="header-section-number">Chapter 6</span> Interactive component</h1>
<p><img src="https://raw.githubusercontent.com/lijning/career-opportunities-analysis/master/others/resource/66.png" /></p>

    <script src="https://d3js.org/d3.v5.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3-legend/2.25.6/d3-legend.js"></script>
    <style>
        chart-title {
            text-align: center;
            font: 300 18px / 1.2 'nyt-franklin', Arial, sans-serif;
            margin-bottom: 20px;
            color: #333;
        }

        .g-chart path {
            stroke-width: 2.5;
        }

        .player-line {
            fill: none;
            stroke-dasharray: 5, 5;
        }

        .dot {
            fill: #ffab00;
            stroke: #fff;
        }

        g.playable rect {
            fill: yellowgreen;
            opacity: 0.1;
        }

        .huge-button {
            display: block;
            /* width: fit-content; */
            padding: 0.35em 1.2em;
            border: 0.05em solid rgb(36, 17, 66);
            margin: 0 0.3em 0.3em 0;
            border-radius: 0.12em;
            box-sizing: border-box;
            text-decoration: none;
            font-family: 'Roboto', sans-serif;
            font-weight: 300;
            color: rgb(36, 17, 66);
            text-align: center;
            transition: all 0.2s;
        }

        .huge-button:hover {
            color: #FFFFFF;
            background-color: #000000;
        }

        .g-points circle {
            fill: cornflowerblue;
            stroke: cornflowerblue;
        }

        .hidden {
            display: none;
        }
    </style>
    <script>
        function groupBy(list, keyGetter) {
            const map = new Map();
            list.forEach((item) => {
                const key = keyGetter(item);
                const collection = map.get(key);
                if (!collection) {
                    map.set(key, [item]);
                } else {
                    collection.push(item);
                }
            });
            return map;
        }
        function usePalette(key) {
            return globalPool.colorScale(key);
            // if (globalPool.palette.has(key)) {
            //     return globalPool.palette.get(key);
            // } else {
            //     pick = colorsArray.pop();
            //     if (pick) {
            //         globalPool.palette.set(key, pick);
            //         return pick;
            //     } else {
            //         throw Error("Running out of colors.")
            //     }
            // }
        }
        function getCoordinates(data) {
            return data.map(
                elem => {
                    return {
                        k: elem.job,
                        x: new Date(elem.month),
                        y: elem.medianBasePay
                    }
                }
            ).sort((a, b) => a.x - b.x);
        }
        function forkDataset(dataMap, hiddenKey) {
            let keys = Array.from(dataMap.keys());
            hiddenKVP = { key: hiddenKey, values: undefined }
            let kvps = keys.map(key => {
                let arr = getCoordinates(dataMap.get(key));
                if (key == hiddenKey) {
                    hiddenKVP.values = arr.slice(idxHiddenStart - 1);
                    lastElem = arr[idxHiddenStart - 1];
                    globalPool.playerData
                        .push([globalPool.xScale(lastElem.x), globalPool.yScale(lastElem.y)])
                    shownValues = arr.slice(0, idxHiddenStart);
                }
                else {
                    shownValues = arr;
                }
                return {
                    key: key, values: shownValues
                };
            });
            if (!hiddenKVP.values) {
                throw Error("Key not matched.");
            }
            globalPool.shownData = kvps;
            globalPool.hiddenData = hiddenKVP;
            return hiddenKVP;
        }
        const dataSrc = "https://raw.githubusercontent.com/lijning/career-opportunities-analysis/master/data/clean/job-month-pay.csv";
        const chartMargin = { left: 80, bottom: 80, top: 30 };
        const idxHiddenStart = 8;
        const chartDim = { height: 400, width: 500 };
        const legendTrans = { left: chartMargin.left + chartDim.width + 50, top: chartMargin.top + 80 };
        const globalPool = {
            xScale: undefined, yScale: undefined,
            shownData: [], hiddenData: {},
            playerData: [], palette: new Map(),
            allDataPoints: [], colorScale: undefined
        };
        const colorsArray = ["#FF4136", "#2ECC40", "#FFDC00", "#001f3f", "#FF851B"]
        const jobPlayWith = "Data Scientist";
    </script>
    <script>
        function addPoints(points) {
            points.forEach(pt => { globalPool.allDataPoints.push(pt); })
            let gPt = d3.select("#diy #g-points");
            let sel = gPt.selectAll("circle");
            sel.data(globalPool.allDataPoints)
                .enter()
                .append("circle")
                .merge(sel)
                .attr('cx', d => globalPool.xScale(d.x))
                .attr('cy', d => globalPool.yScale(d.y))
                .transition()
                .attr('r', 3);
        }
        function drawLines(data, flag) {
            let lineGen = d3.line()
                .x((d, i) => { return globalPool.xScale(d.x); }) // set the x values for the line generator
                .y((d, i) => { return globalPool.yScale(d.y); }) // set the y values for the line generator 
                .curve(d3.curveMonotoneX);
            let lineClass;
            if (flag == 0) {
                lineClass = "fact-line"
            } else {
                lineClass = "answer-line"
            }
            let gPaths = d3.select("g#g-paths");

            gPaths
                //.selectAll("g").attr("class", "g-fact-line")
                .selectAll(`path .${lineClass}`)
                .data(data.map(elem => elem.values))
                .enter()
                .append("path")
                .attr("class", lineClass)
                .attr("fill", "none")
                .style('stroke', (d, i) => usePalette(d[0].k))
                .style("opacity", 0)
                // .attr("duration",5000)
                .transition().duration(1000)
                .style("opacity", 1)
                .attr("d", lineGen);
            data.forEach(elem => { addPoints(elem.values) });
        }
        function fnClickingDraw() {
            let chart = d3.select(".g-chart");
            let coords = d3.mouse(chart.node());
            xValue = globalPool.xScale.invert(coords[0]);
            yValue = globalPool.yScale.invert(coords[1]);
            globalPool.playerData.push(coords);
            globalPool.playerData.sort((a, b) => a[0] - b[0]);
            let sel = d3.select(".g-chart").selectAll("path.player-line")
            sel.data([globalPool.playerData])
                .enter()
                .append("path").attr("class", "player-line")
                .merge(sel)
                .attr("d", d3.line())
                .style("stroke", usePalette(jobPlayWith));
        }
    </script>

    <h3 class="chart-title">Guess how much are data scientists earning compared to others?<br>You draw it!</h3>
    <h5>Since the beginning of 2018, the median base pay of data scientist jobs has been ...</h5>
    <svg id="diy" width="800px" height="500px">
        <text x="20" y="10" style="font: 10px sans-serif;">Median Base Pay</text>
        <g class="g-y-axis"></g>
        <g class="g-x-axis"></g>
        <g class="g-chart">
            <g id="g-paths"></g>
            <g id="g-points"></g>
        </g>
        <g class="g-legend"></g>
    </svg>
    <div id="answer-board" style="width: 600px;">
        <p id="btn-show-answer" class="huge-button">Show me the answer.</p>
        <h5 id="answer-text" class="hidden">... fluctuating and reached the peak at the end of this year. Over the past two years, it has always been the top paid job.</h5>
    </div>


    <script>

        let svg = d3.select("svg#diy");
        let yAxis = svg.select(".g-y-axis")
            .attr("transform", "translate(" + chartMargin.left + ", " + chartMargin.top + ")");
        let xAxis = svg.select(".g-x-axis")
            .attr("transform",
                `translate(${chartMargin.left},${chartMargin.top + chartDim.height})`);
        let chart = svg.select(".g-chart")
            .attr("transform", `translate(${chartMargin.left},${chartMargin.top})`);
        d3.select("svg#diy .g-legend")
            .attr('transform', 'translate(' + (legendTrans.left) +
                ',' + (legendTrans.top) + ')')
        d3.csv(dataSrc).then(data => {
            globalPool.rawDataset = data;
            data = data.filter(row => ["Data Scientist",
                "Software Engineer", "Product Manager"].includes(row.job));
            mapDataGrouped = groupBy(data, row => row.job);
            globalPool.mapDataGrouped = mapDataGrouped;

            let xScale = d3.scaleTime()
                // .domain([d3.extent(data, row => new Date(row.month))])
                .domain([new Date(2017, 5, 1), new Date(2019, 3, 1)])
                .range([0, chartDim.width]);
            globalPool.xScale = xScale;
            let yScale = d3.scaleLinear()
                .domain(d3.extent(data, row => +row.medianBasePay)).nice()
                .range([chartDim.height, 0]);
            globalPool.yScale = yScale;
            xAxis.call(d3.axisBottom(xScale));
            yAxis.call(d3.axisLeft(yScale));

            let hiddenKVP = forkDataset(mapDataGrouped, jobPlayWith);
            globalPool.colorScale = d3.scaleOrdinal()
                .domain(["Data Scientist", "Software Engineer", "Product Manager"])
                .range(colorsArray.slice(0, 3));

            let leftBoundPlayable = xScale(hiddenKVP.values[0].x);
            let playground = chart.append("g")
                .attr("class", "playable")
                .attr("transform", `translate(${leftBoundPlayable},0)`);
            let clickboard = playground.append("rect")
                .attr("width", chartDim.width - leftBoundPlayable)
                .attr("height", chartDim.height)
                .attr("id", "playboard");
            clickboard.on("click", fnClickingDraw);
            drawLines(globalPool.shownData, 0);
            let legendOrdinal = d3.legendColor()
                .shape("path", d3.symbol().type(d3.symbolCircle).size(100)())
                .shapePadding(10)
                //use cellFilter to hide the "e" cell
                .cellFilter(function (d) { return d.label !== "e" })
                .scale(globalPool.colorScale);
            d3.selectAll("#diy .g-legend").call(legendOrdinal);
        });
        d3.select("#btn-show-answer").on("click", () => {
            drawLines([globalPool.hiddenData], 1);
            d3.select("#btn-show-answer").style("display", "none");
            d3.select("#answer-text").style("display", "block");
        });

    </script>

<p>This component is about the trend of Data Scientists’ median base pay. A main interest of our project is why the salary of data sceintists is usually higher than other data related jobs. The game reveals this phenomenon, and the reader can find the answer in our analysis. (Theis graph is implemented with D3.js, and its source code can be seen <a href="https://lijning.github.io/career-opportunities-analysis/results.html#geographical-patterns-of-data-related-jobs">here</a>.)</p>
<p>In the previous sections, there are also two interactive components. One is the <a href="https://lijning.github.io/career-opportunities-analysis/results.html#geographical-patterns-of-data-related-jobs">job openings map</a> implemented usingplotly, and the other one is the <a href="https://lijning.github.io/career-opportunities-analysis/results.html#best-cities-for-data-related-jobs">parallel coordinates plots</a> implemented via parcoods package.</p>

</div>
            </section>

          </div>
        </div>
      </div>
<a href="results.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="conclusion.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/lijning/career-opportunities-analysis/edit/master/analysis-bookdown/06-interactive.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": "https://github.com/lijning/career-opportunities-analysis/blob/master/analysis-bookdown/06-interactive.Rmd",
"text": null
},
"download": null,
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
